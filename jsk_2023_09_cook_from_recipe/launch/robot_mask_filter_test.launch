<launch>
  <arg name="run_rviz" default="true"/>

  <arg name="input_image" default="/kinect_head_remote/rgb/image_rect_color" />
  <arg name="input_cloud" default="/kinect_head_remote/depth_registered/points" />
  <arg name="input_camera_info" default="/kinect_head/rgb/camera_info" />

  <arg name="namespace" default="robot_mask" />

  <node name="robot_to_mask_image"
        pkg="nodelet" type="nodelet"
        args="standalone jsk_perception/RobotToMaskImage"
        output="screen">
    <remap from="~input/camera_info" to="$(arg input_camera_info)"/>
    <rosparam>
      self_see_links:
      - name: l_shoulder_pan_link
      - name: l_shoulder_lift_link
      - name: l_upper_arm_link
      - name: l_upper_arm_roll_link
      - name: l_elbow_flex_link
      - name: l_forearm_link
      - name: l_forearm_roll_link
      - name: l_wrist_flex_link
      - name: l_wrist_roll_link
      - name: l_gripper_palm_link
      - name: l_gripper_l_finger_link
      - name: l_gripper_l_finger_tip_link
      - name: l_gripper_r_finger_link
      - name: l_gripper_r_finger_tip_link
      - name: r_shoulder_pan_link
      - name: r_shoulder_lift_link
      - name: r_upper_arm_link
      - name: r_upper_arm_roll_link
      - name: r_elbow_flex_link
      - name: r_forearm_link
      - name: r_forearm_roll_link
      - name: r_wrist_flex_link
      - name: r_wrist_roll_link
      - name: r_gripper_palm_link
      - name: r_gripper_l_finger_link
      - name: r_gripper_l_finger_tip_link
      - name: r_gripper_r_finger_link
      - name: r_gripper_r_finger_tip_link
      self_see_default_padding: 0.001
    </rosparam>
  </node>

  <group ns='$(arg namespace)'>
    <node name="mask_image_filter"
          pkg="nodelet" type="nodelet"
          args="standalone jsk_pcl/MaskImageFilter"
          respawn="true">
      <param name="~negative" value="true" />
      <remap from="~input" to="$(arg input_cloud)" />
      <remap from="~input/mask" to="/robot_to_mask_image/output" />
      <remap from="~input/camera_info" to="$(arg input_camera_info)" />
    </node>

    <node name="extract_indices"
          pkg="nodelet" type="nodelet"
          args="standalone jsk_pcl/ExtractIndices" >
      <remap from="~input" to="$(arg input_cloud)" />
      <remap from="~indices" to="mask_image_filter/output" />
    </node>
  </group>

  <group if="$(arg run_rviz)">
    <node name="robot_mask_rviz"
          pkg="rviz" type="rviz"
          args="-d $(find jsk_2023_09_cook_from_recipe)/rviz/robot_to_mask_image.rviz"/>
  </group>

</launch>
